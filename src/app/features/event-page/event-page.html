<div class="page-container">
  <header class="page-header">
    <h1>Gestion des <span class="gold-text">Événements</span></h1>
    <p>Visualisation et administration des événements</p>
  </header>

  <div class="content-wrapper fade-in">
    <!-- Barre d'actions -->
    <div class="action-bar">
      <h3>Liste des Événements</h3>
      <button class="btn-add" (click)="onAddEvent()">+ Créer</button>
    </div>

    <!-- Tableau Glass -->
    <div class="glass-table-wrapper">
      <table class="glass-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Nom de l'événement</th>
            <th>Responsable</th>
            <th class="text-end">Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (e of events(); track e.id) {
            <tr>
              <td>
                <span class="text-white">#{{ e.id }}</span>
              </td>
              <td>
                <span class="fw-bold">{{ e.name }}</span>
              </td>
              <td>
                <span class="badge-user">
                  <i class="fa-solid fa-user-tag"></i>{{ e.responsible }}
                </span>
              </td>
              <td class="text-end">
                <button
                  class="btn-icon subscribe"
                  (click)="onSubscribeEvent(e.id)"
                  title="S'inscrire à l'événement"
                >
                  <i class="fa-solid fa-calendar-check"></i>
                </button>
                @if (isAdmin() || e.idUserResponsible === currentUserId()) {
                  <button class="btn-icon edit" (click)="onUpdateEvent(e)">
                    <i class="fa-solid fa-pen"></i>
                  </button>
                  <button class="btn-icon delete" (click)="onDeleteEvent(e.id)">
                    <i class="fa-solid fa-trash"></i>
                  </button>
                }
              </td>
            </tr>
          } @empty {
            <tr>
              <td colspan="4" class="text-center py-4">Aucun événement trouvé.</td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  </div>

  @if (message()) {
    <div class="message-container fade-in">
      <div
        class="alert"
        [class.alert-danger]="isMessageError()"
        [class.alert-success]="!isMessageError()"
      >
        <i
          class="fa-solid"
          [class.fa-circle-xmark]="isMessageError()"
          [class.fa-check-circle]="!isMessageError()"
        >
        </i>

        {{ message() }}
      </div>
    </div>
  }

  <!-- Modal -->
  @if (isModalOpen()) {
    <div class="modal-backdrop" (click)="closeModal()">
      <div class="modal-glass" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>
            @if (modalType() === 'create') {
              Nouvel Événement
            } @else {
              Édition #{{ currentEvent.id }}
            }
          </h3>
          <button class="btn-close" (click)="closeModal()">
            <i class="fa-solid fa-times"></i>
          </button>
        </div>

        <form (ngSubmit)="saveEvent()">
          <div class="form-group">
            <label>Nom de l'événement</label>
            <input
              type="text"
              [(ngModel)]="currentEvent.name"
              name="name"
              placeholder="Ex: Jumuah"
              required
              class="glass-input"
            />
          </div>

          <div class="modal-actions">
            <button type="button" class="btn-cancel" (click)="closeModal()">Annuler</button>
            <button type="submit" class="btn-save" [disabled]="isSubmitting()">
              @if (isSubmitting()) {
                <i class="fa-solid fa-spinner fa-spin"></i> ...
              } @else {
                Sauvegarder
              }
            </button>
          </div>
        </form>
      </div>
    </div>
  }
</div>
